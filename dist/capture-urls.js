// Generated by CoffeeScript 2.4.1
(function () {
  // Deps (needed to be CJS style...)
  var logger, remoteUrls;
  logger = require('./logger').default;
  ({
    remoteUrls
  } = require('./store'));
  /*
  Capture all the remote asset URLs and update them to a local path from an
   * object of data
   */

  module.exports = function (data) {
    var pattern, replacement, text, urlsFound;

    if (process.env.npm_lifecycle_event !== 'generate') {
      // Don't act unless generating
      return data;
    } // Options (needs to be moved into config)


    pattern = /https?:\/\/craft\.infotechinc\.com\/images\/([\w\d-.]+)/gi;
    replacement = '/images/$1'; // Stringify the data for easy replacing

    urlsFound = remoteUrls.length;
    text = JSON.stringify(data);
    text = text.replace(pattern, function (url, filename) {
      if (!remoteUrls.includes(url)) {
        remoteUrls.push(url);
      }

      return replacement.replace('$1', filename);
    }); // Update the log

    logger.info(`Found ${remoteUrls.length - urlsFound} new assets`); // Return updated object

    return JSON.parse(text);
  };
}).call(this);